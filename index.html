<!DOCTYPE html>
<html>

<head>
    <title>Quicky</title>
    <link href="https://fonts.cdnfonts.com/css/aquire" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/motiva-sans" rel="stylesheet">
    <style>
        #userAnswer {
            background-color: transparent;
            border: none;
            color: #7eccaa;
            font-weight: bold;
            font-size: 10vh;
            text-align: center;
            outline: none;
            -moz-appearance: textfield;
            appearance: textfield;
            caret-color: #7eccaa;
            margin-left: 0;
            padding: 0;
        }

        #userAnswer::-webkit-inner-spin-button,
        #userAnswer::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        #problem {
            color: white;
            font-size: 10vh;
            text-align: center;
            margin-bottom: 10px;
        }

        .num1-color {
            color: #7eb5cc;
        }

        #problemContainer {
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            background-color: #262626;
            border-radius: 20px;
            padding: 10px;
            position: fixed;
            top: 40%;
            flex-direction: column;
        }

        #problem {
            margin-right: 20px;
            /* You can reduce this value to bring them closer */
            /* If the #problem div has padding, you can reduce it as well */
            padding-right: 0;
            /* Adjust as needed */
            font-size: 10vh;
        }



        body {
            background-color: rgb(66, 137, 160);
            display: flex;
            flex-direction: column;
            justify-content: start;
            align-items: center;
            height: 100vh;
            font-family: 'motiva-sans', sans-serif;
            position: relative;
            white-space: nowrap;
            /* Prevents text from wrapping */
            overflow: hidden;
            /* Hides text that overflows */
        }

        #counter {
            position: fixed;
            top: 10px;
            right: 10px;
            color: rgb(230, 255, 139);
            z-index: 1000;
            font-size: 4vh;
        }

        h1 {
            margin: 0;
            margin-bottom: 10px;
            position: absolute;
            top: 5%;
            left: 50%;
            transform: translate(-50%, 0);
            /* Correct translation */
            font-family: 'Aquire', sans-serif;
            font-size: 12vh;
            /* Adjust the font size to fit on different screens */
            color: white;
        }

        html,
        body {
            font-weight: bold;
            overflow: hidden;
            /* Prevents scrolling */
            height: 100%;
            /* Sets a fixed height */
        }

        #timer {
            position: fixed;
            top: 10px;
            left: 10px;
            color: rgb(230, 255, 139);
            z-index: 1000;
            font-size: 4vh;
        }

        #resultsPopup {
            background-color: #262626;
            padding: 10px;
            border-radius: 20px;
            box-sizing: border-box;
            /* This line ensures padding is included in width */
            width: 120vh;
            /* This line ensures the popup takes the full viewport width */
            position: fixed;
            /* This line, combined with the following two, ensures */
            left: -10;
            /* the popup is not constrained by parent element's width and */
            right: 10;
            /* positions it relative to the viewport */
            top: 40%;
            /* Start at 50% from the top */
        }

        .popup-content {
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            /* Set the text color to white */
            display: flex;
            font-size: 10vh;
            flex-direction: column;
            font-family: 'motiva-sans', sans-serif;
            font-weight: bold;
        }

        .score-text {
            color: #7eb5cc;
        }

        #score .score-number {
            color: #7eccaa;
        }

        /* Add keyframes for the popup scaling animation */
        @keyframes scalePopup {
            0% {
                transform: scale(0.1);
                opacity: 0;
            }

            80% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes fadeInText {
            0% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }

        #resultsPopup.popup {
            animation: scalePopup 1s ease forwards;
        }


        button {
            background: #333;
            color: #fff;
            border: none;
            padding: 10px 30px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            /* Add cursor style */
            display: inline-block;
            font-family: 'motiva-sans', sans-serif;
            font-weight: bold;
            font-size: 3vh;
        }

        button:hover {
            background-color: #444;
            /* Slightly darker background on hover */
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.1);
            /* More subtle glow */
            transition: background-color 0.1s, box-shadow 0.1s;
            /* Smooth transition for the hover effect */
        }

        #keyboard {
            display: none;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 50vh;
            /* Adjust this value as needed to create space between the problem container and the keyboard */
            width: 100%;
            /* This will make it responsive */
            justify-content: center;
            /* This will center the keys */
            padding: 0 20px;
            /* This gives some space on the sides */
            white-space: normal;
        }


        .key {
            background-color: #FFF;
            /* White key background */
            color: #333;
            /* Dark text */
            padding: 15px;
            text-align: center;
            font-size: 2em;
            border-radius: 5px;
            user-select: none;
            /* Prevents text selection */
            -webkit-tap-highlight-color: transparent;
            /* Removes mobile highlight */
            cursor: pointer;
            /* Pointer to indicate clickable */
            box-shadow: 1px 1px 5px rgba(0, 0, 0, 0.2);
            /* Soft shadow for depth */
        }

        .key:active {
            background-color: #eaeaea;
            /* Feedback when key is pressed */
        }
    </style>
</head>

<body>
    <canvas id="my-canvas"></canvas>
    <canvas id="my-canvas"></canvas>
    <h1>Quicky</h1>
    <div id="counter">0</div>
    <div id="problemContainer">
        <div id="problem"></div>
        <input type="text" id="userAnswer" />
    </div>

    <!-- Keyboard container -->
    <div id="keyboard">
        <!-- Row 1 -->
        <div class="key" data-number="1" ontouchstart="enterNumber('1')">1</div>
        <div class="key" data-number="2" ontouchstart="enterNumber('2')">2</div>
        <div class="key" data-number="3" ontouchstart="enterNumber('3')">3</div>
        <!-- Row 2 -->
        <div class="key" data-number="4" ontouchstart="enterNumber('4')">4</div>
        <div class="key" data-number="5" ontouchstart="enterNumber('5')">5</div>
        <div class="key" data-number="6" ontouchstart="enterNumber('6')">6</div>
        <!-- Row 3 -->
        <div class="key" data-number="7" ontouchstart="enterNumber('7')">7</div>
        <div class="key" data-number="8" ontouchstart="enterNumber('8')">8</div>
        <div class="key" data-number="9" ontouchstart="enterNumber('9')">9</div>
        <!-- Row 4 -->
        <div class="key" data-action="negative" ontouchstart="negative()">NEG</div>
        <div class="key" data-number="0" ontouchstart="enterNumber('0')">0</div>
        <div class="key" data-action="backspace" ontouchstart="backspace()">BACKSPACE</div>
    </div>



    <div id="timer">60</div>
    <!-- Results Popup -->
    <div id="resultsPopup" class="popup" style="display: none;">
        <div class="popup-content">
            <!-- Game results here -->
            <div id="score"><span class="score-text">Score:</span> <span class="score-number">0</span></div>

            <!-- Play Again button placed below the score -->
            <button id="playAgainButton" class="play-again-btn" onclick="playAgain()">Play Again</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/confetti-js@0.0.18/dist/index.min.js"></script>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyDFXcTdZgZcX26eMPeKJaZ9pBQGKe1-4Jo",
            authDomain: "quicky-e1057.firebaseapp.com",
            projectId: "quicky-e1057",
            storageBucket: "quicky-e1057.appspot.com",
            messagingSenderId: "979621688706",
            appId: "1:979621688706:web:a6bad2420285fda1d64b9b",
            measurementId: "G-FDDBWZDNLD"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
    </script>

    <script>
        var confettiSettings = { target: 'my-canvas', start_from_edge: 'true', max: '100', clock: '33' };
        var confetti = new ConfettiGenerator(confettiSettings);

        let lastAnswer = 0; // Variable to store the last answer
        let problemsSolved = 0; // Variable to keep track of the number of problems solved

        function generateProblem() {
            let num1 = lastAnswer; // Start with the last answer
            let num2 = Math.floor(Math.random() * 100);
            let operation;

            let rampDown = 0.5;
            const absSize = Math.abs(lastAnswer);
            if (absSize >= 100) {
                rampDown = 0.5 - (absSize / 400)

                if (num2 < 50) {
                    num2 += absSize / 10
                }
            }
            
            num2 = Math.round(num2);

            // Adjust the probability of choosing addition or subtraction based on lastAnswer
            if (lastAnswer < -100) {
                // Increase probability of addition
                operation = Math.random() > rampDown ? '+' : '-'; // (1.0 - rampDown) chance of addition
            } else if (lastAnswer > 100) {
                // Increase probability of subtraction
                operation = Math.random() > rampDown ? '-' : '+'; // (1.0 - rampDown) chance of subtraction
            } else {
                // If lastAnswer is between -100 and 100, choose randomly
                operation = Math.random() > 0.5 ? '+' : '-';
            }

            let answer;

            if (operation === '+') {
                answer = num1 + num2;
            } else {
                answer = num1 - num2;
            }

            return { question: `${num1} ${operation} ${num2}`, answer: answer };
        }


        function checkAnswer() {
            const userAnswer = parseInt(document.getElementById('userAnswer').value);
            const problem = document.currentProblem;

            if (userAnswer === problem.answer) {
                lastAnswer = problem.answer; // Update the last answer
                problemsSolved++; // Increment the problems solved counter
                updateCounter(); // Update the display of the counter
                setTimeout(loadNewProblem, 150); // Delay
            }
        }


        function updateCounter() {
            document.getElementById('counter').textContent = `${problemsSolved}`;
        }

        function loadNewProblem() {
            const problem = generateProblem();
            document.currentProblem = problem;
            document.getElementById('problem').innerHTML = `<span class="num1-color">${problem.question.split(' ')[0]}</span> ${problem.question.substring(problem.question.indexOf(' '))} =`;
            document.getElementById('userAnswer').value = '';
            updateCounter(); // Ensure the counter is updated when the new problem is loaded
        }

        // Set up the event listener for the input field 
        window.onload = function () {
            setAllFontSize();
            keyboardShowCheck();
            loadNewProblem();
            document.getElementById('userAnswer').focus(); // Focus the invisible input box for user input
            document.getElementById('userAnswer').addEventListener('input', checkAnswer);
            startTimer(); // Start the timer when the window loads
        };

        let timeLeft = 60000; // 1 minute = 60,000 hundredths of a second

        let timerWorker;

        function startTimer() {
            if (window.Worker) {
                timerWorker = new Worker('timerWorker.js');
                timerWorker.postMessage('start'); // Start the timer in the worker

                timerWorker.onmessage = function (e) {
                    let timeLeft = e.data;

                    // Convert milliseconds to seconds (1 second = 1000 milliseconds)
                    let seconds = Math.floor(timeLeft / 1000);

                    // Calculate hundredths of a second
                    // (e.g., 1250 milliseconds is 1 second and 250 milliseconds or 25 hundredths)
                    let hundredths = Math.floor((timeLeft % 1000) / 10);
                    hundredths = hundredths < 10 ? '0' + hundredths : hundredths;

                    document.getElementById('timer').textContent = seconds + '.' + hundredths;

                    if (timeLeft <= 0) {
                        timerWorker.terminate(); // Stop the worker when the timer ends
                        showResultsPopup();
                    }
                };
            }
        }


        function resetAll() {
            problemsSolved = 0;
            lastAnswer = 0;
            timeLeft = 6000;
            loadNewProblem();
        }

        function updateScore() {
            var scoreElement = document.getElementById("score");
            scoreElement.innerHTML = "Score: " + problemsSolved;
        }

        function showResultsPopup() {
            document.getElementById('resultsPopup').style.display = 'block';
            document.getElementById('problemContainer').style.display = 'none'; // Hide the problem container
            document.getElementById('keyboard').style.display = 'none';
            document.getElementById('counter').style.display = 'none';
            document.getElementById('timer').style.display = 'none';
            updateScore();
            startConfetti();
        }

        function playAgain() {
            document.getElementById('resultsPopup').style.display = 'none';
            document.getElementById('problemContainer').style.display = 'flex'; // Show the problem container again
            document.getElementById('counter').style.display = 'flex';
            document.getElementById('timer').style.display = 'flex';
            keyboardShowCheck();
            resetAll();
            startTimer();
            document.getElementById('userAnswer').focus(); // Set focus to the input box
            stopConfetti();
        }

        function startConfetti() {
            confetti = new ConfettiGenerator(confettiSettings);
            confetti.render();
        }

        function stopConfetti() {
            confetti.clear();
        }

        function enterNumber(number) {
            document.getElementById('userAnswer').value += number;
            checkAnswer(); // Call your checkAnswer function
        }

        function backspace() {
            var userAnswer = document.getElementById('userAnswer');
            userAnswer.value = userAnswer.value.slice(0, -1); // Remove last character
        }

        function negative() {
            var userAnswerElement = document.getElementById('userAnswer');
            var userAnswer = userAnswerElement.value;

            if (userAnswer === '' || userAnswer === '-') {
                // Toggle between empty and '-'
                userAnswerElement.value = userAnswer === '' ? '-' : '';
            } else {
                // If userAnswer contains a number, toggle its sign
                var numericValue = parseFloat(userAnswer);
                if (!isNaN(numericValue)) {
                    userAnswerElement.value = -numericValue;
                }
            }
        }



        function keyboardShowCheck() {
            var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            if (!isMobile) {
                document.getElementById('keyboard').style.display = 'none';
            }
            else {
                document.getElementById('keyboard').style.display = 'grid';
            }
        }

        function getSmallerVWVH(percent) {
            // Get viewport width and height
            let vw = window.innerWidth;
            let vh = window.innerHeight;

            // Calculate 10% of viewport width and height
            let usedVW = vw * percent / 100;
            let usedVH = vh * percent / 100;

            // Return the smaller of the two values
            return Math.round(Math.min(usedVW, usedVH));
        }

        // Modular function to set font size
        function setFontSize(selector) {
            let elements;

            // Determine the type of the selector and get the elements
            if (selector.startsWith('#')) {
                // ID selector
                elements = [document.getElementById(selector.substring(1))];
            } else if (selector.startsWith('.')) {
                // Class selector
                elements = document.getElementsByClassName(selector.substring(1));
            } else {
                // Tag selector
                elements = document.getElementsByTagName(selector);
            }

            // Set font size for the selected elements
            for (let element of elements) {
                if (element) {
                    element.style.fontSize = getSmallerVWVH() + 'px';
                }
            }
        }

        // Example usage
        document.addEventListener('DOMContentLoaded', () => {
            setAllFontSize
        });

        // Optionally, adjust font size on window resize
        window.addEventListener('resize', () => {
            setAllFontSize
        });

        function setAllFontSize() {
            setFontSize('#userAnswer');
            setFontSize('#problem');
            setFontSize('h1');
            setFontSize('.popup-content');
        }



    </script>
</body>

</html>